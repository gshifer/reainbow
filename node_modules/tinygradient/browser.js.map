{"version":3,"file":"browser.js","sources":["index.js"],"sourcesContent":["const tinycolor = require('tinycolor2');\n\n/**\n * @typedef {Object} TinyGradient.StopInput\n * @property {ColorInput} color\n * @property {number} pos\n */\n\n/**\n * @typedef {Object} TinyGradient.StepValue\n * @type {number} [r]\n * @type {number} [g]\n * @type {number} [b]\n * @type {number} [h]\n * @type {number} [s]\n * @type {number} [v]\n * @type {number} [a]\n */\n\n/**\n * @type {StepValue}\n */\nconst RGBA_MAX = { r: 256, g: 256, b: 256, a: 1 };\n\n/**\n * @type {StepValue}\n */\nconst HSVA_MAX = { h: 360, s: 1, v: 1, a: 1 };\n\n/**\n * Linearly compute the step size between start and end (not normalized)\n * @param {StepValue} start\n * @param {StepValue} end\n * @param {number} steps - number of desired steps\n * @return {StepValue}\n */\nfunction stepize(start, end, steps) {\n    let step = {};\n\n    for (let k in start) {\n        if (start.hasOwnProperty(k)) {\n            step[k] = steps === 0 ? 0 : (end[k] - start[k]) / steps;\n        }\n    }\n\n    return step;\n}\n\n/**\n * Compute the final step color\n * @param {StepValue} step - from `stepize`\n * @param {StepValue} start\n * @param {number} i - color index\n * @param {StepValue} max - rgba or hsva of maximum values for each channel\n * @return {StepValue}\n */\nfunction interpolate(step, start, i, max) {\n    let color = {};\n\n    for (let k in start) {\n        if (start.hasOwnProperty(k)) {\n            color[k] = step[k] * i + start[k];\n            color[k] = color[k] < 0 ? color[k] + max[k] : (max[k] !== 1 ? color[k] % max[k] : color[k]);\n        }\n    }\n\n    return color;\n}\n\n/**\n * Generate gradient with RGBa interpolation\n * @param {StopInput} stop1\n * @param {StopInput} stop2\n * @param {number} steps\n * @return {tinycolor[]} color1 included, color2 excluded\n */\nfunction interpolateRgb(stop1, stop2, steps) {\n    const start = stop1.color.toRgb();\n    const end = stop2.color.toRgb();\n    const step = stepize(start, end, steps);\n    let gradient = [stop1.color];\n\n    for (let i = 1; i < steps; i++) {\n        const color = interpolate(step, start, i, RGBA_MAX);\n        gradient.push(tinycolor(color));\n    }\n\n    return gradient;\n}\n\n/**\n * Generate gradient with HSVa interpolation\n * @param {StopInput} stop1\n * @param {StopInput} stop2\n * @param {number} steps\n * @param {boolean} trigonometric - true to step in trigonometric order\n * @return {tinycolor[]} color1 included, color2 excluded\n */\nfunction interpolateHsv(stop1, stop2, steps, trigonometric) {\n    const start = stop1.color.toHsv();\n    const end = stop2.color.toHsv();\n    const step = stepize(start, end, steps);\n    let gradient = [stop1.color];\n\n    // recompute hue\n    let diff;\n    if ((start.h <= end.h && !trigonometric) || (start.h >= end.h && trigonometric)) {\n        diff = end.h - start.h;\n    }\n    else if (trigonometric) {\n        diff = 360 - end.h + start.h;\n    }\n    else {\n        diff = 360 - start.h + end.h;\n    }\n    step.h = Math.pow(-1, trigonometric ? 1 : 0) * Math.abs(diff) / steps;\n\n    for (let i = 1; i < steps; i++) {\n        const color = interpolate(step, start, i, HSVA_MAX);\n        gradient.push(tinycolor(color));\n    }\n\n    return gradient;\n}\n\n/**\n * Compute substeps between each stops\n * @param {StopInput[]} stops\n * @param {number} steps\n * @return {number[]}\n */\nfunction computeSubsteps(stops, steps) {\n    const l = stops.length;\n\n    // validation\n    steps = parseInt(steps, 10);\n\n    if (isNaN(steps) || steps < 2) {\n        throw new Error('Invalid number of steps (< 2)');\n    }\n    if (steps < l) {\n        throw new Error('Number of steps cannot be inferior to number of stops');\n    }\n\n    // compute substeps from stop positions\n    let substeps = [];\n\n    for (let i = 1; i < l; i++) {\n        const step = (steps - 1) * (stops[i].pos - stops[i - 1].pos);\n        substeps.push(Math.max(1, Math.round(step)));\n    }\n\n    // adjust number of steps\n    let totalSubsteps = 1;\n    for (let n = l - 1; n--;) totalSubsteps += substeps[n];\n\n    while (totalSubsteps !== steps) {\n        if (totalSubsteps < steps) {\n            const min = Math.min.apply(null, substeps);\n            substeps[substeps.indexOf(min)]++;\n            totalSubsteps++;\n        }\n        else {\n            const max = Math.max.apply(null, substeps);\n            substeps[substeps.indexOf(max)]--;\n            totalSubsteps--;\n        }\n    }\n\n    return substeps;\n}\n\n/**\n * Compute the color at a specific position\n * @param {StopInput[]} stops\n * @param {number} pos\n * @param {string} method\n * @param {StepValue} max\n * @returns {tinycolor}\n */\nfunction computeAt(stops, pos, method, max) {\n    if (pos < 0 || pos > 1) {\n        throw new Error('Position must be between 0 and 1');\n    }\n\n    let start, end;\n    for (let i = 0, l = stops.length; i < l - 1; i++) {\n        if (pos >= stops[i].pos && pos < stops[i + 1].pos) {\n            start = stops[i];\n            end = stops[i + 1];\n            break;\n        }\n    }\n\n    if (!start) {\n        start = end = stops[stops.length - 1];\n    }\n\n    const step = stepize(start.color[method](), end.color[method](), (end.pos - start.pos) * 100);\n    const color = interpolate(step, start.color[method](), Math.round((pos - start.pos) * 100), max);\n    return tinycolor(color);\n}\n\nclass TinyGradient {\n    /**\n     * @param {StopInput[]|ColorInput[]} stops\n     * @returns {TinyGradient}\n     */\n    constructor(stops) {\n        // validation\n        if (stops.length < 2) {\n            throw new Error('Invalid number of stops (< 2)');\n        }\n\n        const havingPositions = stops[0].pos !== undefined;\n        const l = stops.length;\n        let p = -1;\n        // create tinycolor objects and clean positions\n        this.stops = stops.map(function(stop, i) {\n            const hasPosition = stop.pos !== undefined;\n            if (havingPositions ^ hasPosition) {\n                throw new Error('Cannot mix positionned and not posionned color stops');\n            }\n\n            if (hasPosition) {\n                stop = {\n                    color: tinycolor(stop.color),\n                    pos  : stop.pos\n                };\n\n                if (stop.pos < 0 || stop.pos > 1) {\n                    throw new Error('Color stops positions must be between 0 and 1');\n                }\n                else if (stop.pos <= p) {\n                    throw new Error('Color stops positions are not ordered');\n                }\n                p = stop.pos;\n            }\n            else {\n                stop = {\n                    color: tinycolor(stop),\n                    pos  : i / (l - 1)\n                };\n            }\n\n            return stop;\n        });\n\n        if (this.stops[0].pos !== 0) {\n            this.stops.unshift({\n                color: this.stops[0].color,\n                pos  : 0\n            });\n        }\n        if (this.stops[this.stops.length - 1].pos !== 1) {\n            this.stops.push({\n                color: this.stops[this.stops.length - 1].color,\n                pos  : 1\n            });\n        }\n    }\n\n    /**\n     * Return new instance with reversed stops\n     * @return {TinyGradient}\n     */\n    reverse() {\n        let stops = [];\n\n        this.stops.forEach(function(stop) {\n            stops.push({\n                color: stop.color,\n                pos  : 1 - stop.pos\n            });\n        });\n\n        return new TinyGradient(stops.reverse());\n    }\n\n    /**\n     * Generate gradient with RGBa interpolation\n     * @param {number} steps\n     * @return {tinycolor[]}\n     */\n    rgb(steps) {\n        const substeps = computeSubsteps(this.stops, steps);\n        let gradient = [];\n\n        for (let i = 0, l = this.stops.length; i < l - 1; i++) {\n            const rgb = interpolateRgb(this.stops[i], this.stops[i + 1], substeps[i]);\n            gradient.splice(gradient.length, 0, ...rgb);\n        }\n\n        gradient.push(this.stops[this.stops.length - 1].color);\n\n        return gradient;\n    }\n\n    /**\n     * Generate gradient with HSVa interpolation\n     * @param {number} steps\n     * @param {boolean|String} [mode=false]\n     *    - false to step in clockwise\n     *    - true to step in trigonometric order\n     *    - 'short' to use the shortest way\n     *    - 'long' to use the longest way\n     * @return {tinycolor[]}\n     */\n    hsv(steps, mode) {\n        const substeps = computeSubsteps(this.stops, steps);\n        let gradient = [];\n\n        for (let i = 0, l = this.stops.length; i < l - 1; i++) {\n            const start = this.stops[i].color.toHsv();\n            const end = this.stops[i + 1].color.toHsv();\n\n            // rgb interpolation if one of the steps in grayscale\n            let hsv;\n            if (start.s === 0 || end.s === 0) {\n                hsv = interpolateRgb(this.stops[i], this.stops[i + 1], substeps[i]);\n            }\n            else {\n                let trigonometricStep;\n                if (typeof mode === 'boolean') {\n                    trigonometricStep = mode;\n                }\n                else {\n                    const trigShortest = (start.h < end.h && end.h - start.h < 180) || (start.h > end.h && start.h - end.h > 180);\n                    trigonometricStep = (mode === 'long' && trigShortest) || (mode === 'short' && !trigShortest);\n                }\n                hsv = interpolateHsv(this.stops[i], this.stops[i + 1], substeps[i], trigonometricStep);\n            }\n            gradient.splice(gradient.length, 0, ...hsv);\n        }\n\n        gradient.push(this.stops[this.stops.length - 1].color);\n\n        return gradient;\n    }\n\n    /**\n     * Generate CSS3 command (no prefix) for this gradient\n     * @param {String} [mode=linear] - 'linear' or 'radial'\n     * @param {String} [direction] - default is 'to right' or 'ellipse at center'\n     * @return {String}\n     */\n    css(mode, direction) {\n        mode = mode || 'linear';\n        direction = direction || (mode === 'linear' ? 'to right' : 'ellipse at center');\n\n        let css = mode + '-gradient(' + direction;\n        this.stops.forEach(function(stop) {\n            css += ', ' + stop.color.toRgbString() + ' ' + (stop.pos * 100) + '%';\n        });\n        css += ')';\n        return css;\n    }\n\n    /**\n     * Returns the color at specific position with RGBa interpolation\n     * @param {number} pos, between 0 and 1\n     * @return {tinycolor}\n     */\n    rgbAt(pos) {\n        return computeAt(this.stops, pos, 'toRgb', RGBA_MAX);\n    }\n\n    /**\n     * Returns the color at specific position with HSVa interpolation\n     * @param {number} pos, between 0 and 1\n     * @return {tinycolor}\n     */\n    hsvAt(pos) {\n        return computeAt(this.stops, pos, 'toHsv', HSVA_MAX);\n    }\n}\n\n/**\n * @param {StopInput[]|ColorInput[]|StopInput...|ColorInput...} stops\n * @returns {TinyGradient}\n */\nmodule.exports = function(stops) {\n    // varargs\n    if (arguments.length === 1) {\n        if (!(arguments[0] instanceof Array)) {\n            throw new Error('\"stops\" is not an array');\n        }\n        stops = arguments[0];\n    }\n    else {\n        stops = Array.prototype.slice.call(arguments);\n    }\n\n    return new TinyGradient(stops);\n};\n"],"names":["RGBA_MAX","r","g","b","a","HSVA_MAX","h","s","v","stepize","start","end","steps","step","k","hasOwnProperty","interpolate","i","max","color","interpolateRgb","stop1","stop2","toRgb","gradient","push","tinycolor","interpolateHsv","trigonometric","toHsv","diff","Math","pow","abs","computeSubsteps","stops","l","length","parseInt","isNaN","Error","substeps","pos","round","totalSubsteps","n","min","apply","indexOf","computeAt","method","TinyGradient","havingPositions","undefined","p","map","stop","hasPosition","unshift","reverse","forEach","rgb","splice","hsv","mode","trigonometricStep","trigShortest","css","direction","toRgbString","rgbAt","hsvAt","arguments","Array","prototype","slice","call"],"mappings":"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"}